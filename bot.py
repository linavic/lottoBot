import loggingimport osfrom aiogram import Bot, Dispatcher, typesfrom aiogram.contrib.middlewares.logging import LoggingMiddlewarefrom aiogram.utils import executorfrom dotenv import load_dotenv# ×™×™×‘×•× ×§×‘×¦×™× ×¤× ×™××™×™×from lotto_analysis import get_lotto_predictionsfrom payment_verification import is_user_paid, mark_user_as_paidfrom keep_alive import start_serverload_dotenv()API_TOKEN = os.getenv('TELEGRAM_API_TOKEN')PAYMENT_LINK = os.getenv('PAYMENT_LINK')INVITE_LINK = os.getenv('INVITE_LINK')# ×”×’×“×¨ ××ª ×”-ID ×©×œ×š ×›××Ÿ ×›×“×™ ×©×¨×§ ××ª×” ×ª×•×›×œ ×œ××©×¨ ×ª×©×œ×•××™×ADMIN_ID = os.getenv('ADMIN_ID') logging.basicConfig(level=logging.INFO)if not API_TOKEN:    print("Error: TELEGRAM_API_TOKEN not found in .env or environment variables")bot = Bot(token=API_TOKEN)dp = Dispatcher(bot)dp.middleware.setup(LoggingMiddleware())@dp.message_handler(commands=['start'])async def send_welcome(message: types.Message):    await message.reply("×‘×¨×•×š ×”×‘× ×œ×‘×•×˜ ×”×”×’×¨×œ×•×ª ×©×œ× ×• ğŸ‰\n"                        "×”××¢×¨×›×ª ××‘×•×¡×¡×ª ×¢×œ ××œ×’×•×¨×™×ª× ×¡×˜×˜×™×¡×˜×™ ×—×›×.\n"                        "×œ×—×¥ ×¢×œ 'Lotto' ×œ×§×‘×œ×ª ×”××¡×¤×¨×™× ×©×œ×š.",                        reply_markup=types.InlineKeyboardMarkup().add(                            types.InlineKeyboardButton('ğŸ° ×§×‘×œ ××¡×¤×¨×™ LOTTO', callback_data='lotto')                        ))@dp.callback_query_handler(lambda c: c.data == 'lotto')async def process_lotto(callback_query: types.CallbackQuery):    user_id = callback_query.from_user.id    logging.info(f"User {user_id} requested lotto")        if not is_user_paid(user_id):        # ×”×•×“×¢×” ×œ××©×ª××© ×©×œ× ×©×™×œ×        await bot.send_message(user_id,                                "ğŸ”’ **×”×’×™×©×” ×—×¡×•××”**\n\n"                               "×›×“×™ ×œ×§×‘×œ ××ª ×”×ª×—×–×™×ª ×”×¡×˜×˜×™×¡×˜×™×ª, ×™×© ×œ×‘×¦×¢ ×ª×©×œ×•× ×¡××œ×™.\n"                               "×œ××—×¨ ×”×ª×©×œ×•×, ×©×œ×— ×¦×™×œ×•× ××¡×š ×œ×× ×”×œ ×œ××™×©×•×¨.\n\n"                               f"×”-ID ×©×œ×š ×œ××™×©×•×¨: `{user_id}`",                               parse_mode="Markdown",                               reply_markup=types.InlineKeyboardMarkup().add(                                   types.InlineKeyboardButton('ğŸ’³ ×œ×ª×©×œ×•× ×‘-PayPal', url=PAYMENT_LINK or "http://paypal.com"),                               ))    else:        # ×œ×•×’×™×§×” ×œ××©×ª××© ×©×©×™×œ×        try:            results = get_lotto_predictions()            # ×¢×™×¦×•×‘ ×™×¤×” ×©×œ ×”×ª×•×¦××•×ª            response_text = "ğŸ« **×”××¡×¤×¨×™× ×”××•××œ×¦×™× ×©×œ×š ×œ×”×™×•×:**\n\n"            for i, row in enumerate(results, 1):                # ×× ×™×— ×©×”××¡×¤×¨ ×”××—×¨×•×Ÿ ×”×•× ×”××¡×¤×¨ ×”×—×–×§                nums = row[:-1]                strong = row[-1]                response_text += f"{i}. {nums} | ×—×–×§: {strong}\n"                        response_text += "\n×‘×”×¦×œ×—×”! ğŸ€"                        await bot.send_message(user_id, response_text, parse_mode="Markdown")                    except Exception as e:            logging.error(f"Error generating predictions: {e}")            await bot.send_message(user_id, "××™×¨×¢×” ×©×’×™××” ×‘×—×™×©×•×‘ ×”× ×ª×•× ×™×. ×× × × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨.")# ×¤×§×•×“×ª ××“××™×Ÿ ×œ××™×©×•×¨ ×™×“× ×™# ×©×™××•×©: /approve 12345678@dp.message_handler(commands=['approve'])async def manual_approve(message: types.Message):    # ×‘×“×™×§×ª ×”×¨×©××•×ª (×œ× ×—×•×‘×” ×× ×–×” ×¨×§ ××ª×” ×‘×‘×•×˜, ××‘×œ ××•××œ×¥)    # if str(message.from_user.id) != str(ADMIN_ID):     #     return            try:        target_id = int(message.get_args())        mark_user_as_paid(target_id)        await message.reply(f"âœ… ××©×ª××© {target_id} ××•×©×¨ ×‘×”×¦×œ×—×” ×•×™×›×•×œ ×œ×”×©×ª××© ×‘×‘×•×˜.")                # ××•×¤×¦×™×•× ×œ×™: ×©×œ×™×—×ª ×”×•×“×¢×” ×œ××©×ª××© ×©××•×©×¨        try:            await bot.send_message(target_id, "âœ… ×”×ª×©×œ×•× ××•×©×¨! ××ª×” ×™×›×•×œ ×›×¢×ª ×œ×œ×—×•×¥ ×¢×œ ×›×¤×ª×•×¨ ×”-LOTTO.")        except:            pass                except (ValueError, TypeError):        await message.reply("×©×’×™××”: ×× × ×©×œ×— ID ×ª×§×™×Ÿ.\n×“×•×’××”: `/approve 12345678`")if __name__ == '__main__':    # ×‘×“×™×§×” ×× ×× ×—× ×• ×¨×¦×™× ×‘×ª×•×š Render    if 'RENDER' in os.environ:        # ×”×¨×¦×ª ×©×¨×ª ×”××™× ×˜×¨× ×˜ ×‘×¨×§×¢        server_app, port = start_server()                # ×”×¨×¦×ª ×”×‘×•×˜ ×‘××§×‘×™×œ (Polling)        # ×”×¢×¨×”: ×‘×™×™×¦×•×¨ ×××™×ª×™ ×¢×“×™×£ Webhooks, ××š ×–×” ×”×¤×ª×¨×•×Ÿ ×”×¤×©×•×˜ ×‘×™×•×ª×¨ ×œ-Render Free        loop = executor.get_event_loop()        loop.create_task(executor.start_polling(dp, skip_updates=True))                # ×”×¨×¦×ª ×”×©×¨×ª ×©×œ aiohttp (×—×•×¡× ××ª ×”×¨×™×¦×” ×•×œ×›×Ÿ ×”×‘×•×˜ ×¨×¥ ×‘-Task ×œ××¢×œ×”)        web.run_app(server_app, port=port)    else:        # ×”×¨×¦×” ××§×•××™×ª ×¨×’×™×œ×” ×‘××—×©×‘ ×©×œ×š        print("Bot is running locally...")        executor.start_polling(dp, skip_updates=True)