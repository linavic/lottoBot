import requestsimport osimport json# קובץ לשמירת משתמשים ששילמוPAID_USERS_FILE = 'paid_users.json'PAYPAL_API_URL = "https://api-m.sandbox.paypal.com"  # לשינוי ל-Live במעבר לייצורCLIENT_ID = os.getenv('PAYPAL_CLIENT_ID')CLIENT_SECRET = os.getenv('PAYPAL_CLIENT_SECRET')def load_paid_users():    if not os.path.exists(PAID_USERS_FILE):        return []    with open(PAID_USERS_FILE, 'r') as f:        try:            return json.load(f)        except json.JSONDecodeError:            return []def save_paid_user(user_id):    users = load_paid_users()    if user_id not in users:        users.append(user_id)        with open(PAID_USERS_FILE, 'w') as f:            json.dump(users, f)def get_paypal_access_token():    url = f"{PAYPAL_API_URL}/v1/oauth2/token"    headers = {        "Accept": "application/json",        "Accept-Language": "en_US",    }    data = {"grant_type": "client_credentials"}    response = requests.post(url, headers=headers, data=data, auth=(CLIENT_ID, CLIENT_SECRET))    response.raise_for_status()    return response.json()['access_token']def verify_payment(payment_id):    # כאן נדרשת אינטגרציה אמיתית מול ה-Webhook של פייפאל או בדיקה יזומה    # לצורך הדוגמה, הפונקציה בודקת סטטוס מול ה-API    try:        url = f"{PAYPAL_API_URL}/v2/checkout/orders/{payment_id}"        access_token = get_paypal_access_token()        headers = {            "Content-Type": "application/json",            "Authorization": f"Bearer {access_token}"        }        response = requests.get(url, headers=headers)        if response.status_code == 200:            payment_info = response.json()            return payment_info['status'] == 'COMPLETED'        return False    except Exception as e:        print(f"Error verifying payment: {e}")        return Falsedef is_user_paid(user_id):    users = load_paid_users()    return user_id in usersdef mark_user_as_paid(user_id):    save_paid_user(user_id)